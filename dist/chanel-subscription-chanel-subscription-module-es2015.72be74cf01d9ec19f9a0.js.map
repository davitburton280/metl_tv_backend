{"version":3,"sources":["webpack:///src/app/core/services/subscription-plan.service.ts","webpack:///src/app/chanel-subscription/subscription-chanel/subscription-chanel.component.html","webpack:///src/app/chanel-subscription/subscription-chanel/subscription-chanel.component.ts","webpack:///src/app/chanel-subscription/subscription-chanel/plan-chanel/plan-chanel.component.html","webpack:///src/app/chanel-subscription/chanel-subscription-routing.module.ts","webpack:///src/app/chanel-subscription/subscription-chanel/plan-chanel/plan-chanel.component.ts","webpack:///src/app/chanel-subscription/chanel-subscription.module.ts"],"names":["SubscriptionPlanService","_httpClient","token","localStorage","getItem","headers","Authorization","this","get","permission","formData","post","SubscriptionChanelComponent","router","_subscriptionPlanService","planListImg","_getSubscriptionPlan","cost","plan_id","navigate","queryParams","plan","JSON","stringify","getSubscriptionPlan","subscribe","data","planList","routes","path","component","title","PlanChanelComponent","route","_location","subject","dialog","paymentsService","_userInfoService","subscriptions","_getAuthInfo","params","snapshot","constantCost","console","log","_getPlan","push","currentUserCards","dt","userCards","_userInfo","authUser","getSubscriptionPlanViewByPermission","reverse","forEach","elem","element","toLowerCase","includes","custom_fields","badgeColor","planIcon","img","planName","event","value","total","totalCost","saleCostTotal","toFixed","discount","discountMonths","undefined","open","width","cards","afterClosed","payment","paymentIntent","status","height","getAllPaymentsHistory","user_id","id","customer","ph","setAllPaymentsData","changePaymentsData","buySubscriptionPlan","planId","back","backPage","ChanelSubscriptionRoutingModule","forChild","ChanelSubscriptionModule"],"mappings":"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","file":"x","sourcesContent":["import {Injectable} from '@angular/core';\r\nimport {HttpClient, HttpHeaders} from '@angular/common/http';\r\nimport {SubscriptionPlanResponseInterface} from '@core/interfaces/subscription-plan.interface';\r\nimport {PlanChanelResponseInterface} from '@core/interfaces/plan-chanel.interface';\r\nimport {API_URL} from '@core/constants/global';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\n\r\nexport class SubscriptionPlanService {\r\n    constructor(\r\n        private _httpClient: HttpClient) {\r\n    }\r\n\r\n    public getSubscriptionPlan() {\r\n        const token = localStorage.getItem('token');\r\n        const headers = new HttpHeaders({\r\n            // 'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${token}`\r\n        });\r\n\r\n        const requestOptions = {headers};\r\n\r\n        return this._httpClient.get<SubscriptionPlanResponseInterface>(`${API_URL}plan`, requestOptions);\r\n\r\n    }\r\n\r\n    public getSubscriptionPlanViewByPermission(permission) {\r\n        const token = localStorage.getItem('token');\r\n        const headers = new HttpHeaders({\r\n            // 'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${token}`\r\n        });\r\n\r\n        const requestOptions = {headers};\r\n\r\n        return this._httpClient.get<PlanChanelResponseInterface>(`${API_URL}permission?idList=${permission}`\r\n            , requestOptions);\r\n    }\r\n\r\n    public buySubscriptionPlan(formData) {\r\n        const token = localStorage.getItem('token');\r\n        const headers = new HttpHeaders({\r\n            Authorization: `Bearer ${token}`\r\n        });\r\n\r\n        const requestOptions = {headers};\r\n\r\n        return this._httpClient.post<any>(`${API_URL}stripe/payments/create-subscription-payment-intent`,\r\n            formData, requestOptions);\r\n    }\r\n}\r\n","<div class=\"channelDiv\">\r\n    <div class=\"channelSubscriptionDiv\">\r\n        <div class=\"logoAndChannel\">\r\n            <img src=\"../../assets/img/logoSubscriptionPart.png\" alt=\"logo\">\r\n            <div class=\"channelAndIcon\">\r\n                <div class=\"channelSubscription\"> Metl.tv Channel Subscribtion</div>\r\n                <img src=\"../../assets/img/rocket.png\" alt=\"rocket\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"channelBelowDiv\">\r\n        <div class=\"chooseTrier\">Choose Trier for Subscrition</div>\r\n        <div class=\"subscriptionText\">With Metl.tv Channel subscribtion gets even better with features you can't get\r\n            anywhere else.\r\n        </div>\r\n        <div class=\"cardDivs\">\r\n            <div class=\"cardDiv\" *ngFor=\"let plan of planList;let i = index\">\r\n                <div class=\"cardPart1\">\r\n                    <img [src]=planListImg[i].img alt=\"bronzeFrame\">\r\n                    <div class=\"cardTitle\">{{plan.name}}</div>\r\n                </div>\r\n                <div class=\"cardText\">{{plan.description}}</div>\r\n                <div class=\"cardPart2\">\r\n                    <div class=\"cardLeftPart\">\r\n                        <div class=\"cardLeftPart1\">{{plan.name}}</div>\r\n                        <div class=\"cardLeftPart2\">${{plan.cost}} / Month</div>\r\n                    </div>\r\n                    <button class=\"cardRightPartBtn\" (click)=\"goToPlanChanel(plan.permissions,plan.cost,plan.id)\">View\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","import {Component, OnInit} from '@angular/core';\r\nimport {Router} from '@angular/router';\r\nimport {SubscriptionPlanService} from '@core/services/subscription-plan.service';\r\nimport {SubscriptionPlanData, SubscriptionPlanResponseInterface} from '@core/interfaces/subscription-plan.interface';\r\nimport {CHANEL_SUBSCRIPTIONS_LIST} from '@core/constants/global';\r\n\r\n@Component({\r\n    selector: 'app-subscription-chanel',\r\n    templateUrl: './subscription-chanel.component.html',\r\n    styleUrls: ['./subscription-chanel.component.scss']\r\n})\r\nexport class SubscriptionChanelComponent implements OnInit {\r\n\r\n    public planList: SubscriptionPlanData [] | undefined;\r\n    public planListImg = CHANEL_SUBSCRIPTIONS_LIST;\r\n\r\n    constructor(\r\n        private router: Router,\r\n        private _subscriptionPlanService: SubscriptionPlanService\r\n    ) {\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this._getSubscriptionPlan();\r\n    }\r\n\r\n    goToPlanChanel(permission, cost, plan_id) {\r\n        this.router.navigate(['turbo-plan/plan-chanel'], {\r\n            queryParams: {\r\n                plan: JSON.stringify(permission),\r\n                cost: JSON.stringify(cost),\r\n                plan_id: JSON.stringify(plan_id)\r\n            }\r\n        });\r\n    }\r\n\r\n    private _getSubscriptionPlan() {\r\n        this._subscriptionPlanService.getSubscriptionPlan()\r\n            .subscribe((data: SubscriptionPlanResponseInterface) => {\r\n                this.planList = data.data;\r\n            });\r\n    }\r\n\r\n}\r\n","<div class=\"channelDiv\">\r\n    <div class=\"channelSubscriptionDiv\">\r\n        <div class=\"logoAndChannel\">\r\n            <img src=\"../../assets/img/logoSubscriptionPart.png\" alt=\"logo\">\r\n            <div class=\"channelAndIcon\">\r\n                <div class=\"channelSubscription\"> Metl.tv Channel Subscribtion</div>\r\n                <img src=\"../../assets/img/rocket.png\" alt=\"logo\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"backAndDetailsDiv\">\r\n        <div class=\"backDiv\" (click)=\"backPage()\">\r\n            <img src=\"../../assets/img/backSign.png\" alt=\"backSign\">\r\n            <div class=\"back\">Back</div>\r\n        </div>\r\n        <div class=\"detailsDiv\">Details</div>\r\n        <div></div>\r\n    </div>\r\n    <div class=\"cardDetailed\" *ngIf=\"plan\">\r\n        <div class=\"CardDetailedTitleAndLogo\">\r\n            <div class=\"CardDetailedLogo\">\r\n                <img [src]='planIcon' alt=\"goldFrame\">\r\n            </div>\r\n            <div class=\"CardDetailedTitle\">\r\n                {{plan[0]?.custom_fields?.badgeColor | capitalizeAddSpaces}} Trier\r\n            </div>\r\n        </div>\r\n        <div class=\"cardsTotal\">\r\n            <div class=\"cardTotalDiv\" *ngFor=\"let item of plan;let i = index\">\r\n                <div class=\"cardDiv1\">{{item.name}}</div>\r\n                <div class=\"cardDiv2\">\r\n                    <img *ngIf=\"i === 0\"\r\n                         src=\"../../assets/img/freeGreenIcon.png\" alt=\"freeIcon\">\r\n                    <img *ngIf=\"i === 1\"\r\n                         [src]='planIcon' alt=\"goldIcon\">\r\n                    <img *ngIf=\"(planName === 'silver' || planName === 'gold') && i === 2\"\r\n                         src=\"../../assets/img/colorCircle.png\" alt=\"colorCircle\">\r\n                    <img *ngIf=\"(planName === 'gold') && i === 3\"\r\n                         src=\"../../assets/img/sadIcon.png\" alt=\"sadIcon\">\r\n                    <img *ngIf=\"(planName === 'gold') && i === 3\"\r\n                         class=\"coolImgClassName\"\r\n                         src=\"../../assets/img/coolIcon.png\" alt=\"coolIcon\">\r\n                </div>\r\n                <div class=\"cardDiv3\">{{item.description}}</div>\r\n            </div>\r\n            <!--            <div class=\"cardTotalDiv\">-->\r\n            <!--                <div class=\"cardDiv1\">{{plan[0].name}}</div>-->\r\n            <!--                <div class=\"cardDiv2\">-->\r\n            <!--                    <img [src]='planIcon' alt=\"goldIcon\">-->\r\n            <!--                </div>-->\r\n            <!--                <div class=\"cardDiv3\">{{plan[0].description}}</div>-->\r\n            <!--            </div>-->\r\n            <!--            <div class=\"cardTotalDiv\" *ngIf=\"planName === 'silver' || planName === 'gold'\">-->\r\n            <!--                <div class=\"cardDiv1\">Custom Chat Username Colors</div>-->\r\n            <!--                <div class=\"cardDiv2\">-->\r\n            <!--                    <img src=\"../../assets/img/colorCircle.png\" alt=\"colorCircle\">-->\r\n            <!--                </div>-->\r\n            <!--                <div class=\"cardDiv3\">{{plan[0].description}}-->\r\n            <!--                </div>-->\r\n            <!--            </div>-->\r\n            <!--            <div class=\"cardTotalDiv\" *ngIf=\"planName === 'gold'\">-->\r\n            <!--                <div class=\"cardDiv1\">Custom Chat Username Colors</div>-->\r\n            <!--                <div class=\"cardDiv2\">-->\r\n            <!--                    <img src=\"../../assets/img/sadIcon.png\" alt=\"sadIcon\">-->\r\n            <!--                    <img class=\"coolImgClassName\" src=\"../../assets/img/coolIcon.png\" alt=\"coolIcon\">-->\r\n            <!--                </div>-->\r\n            <!--                <div class=\"cardDiv3\">User gets custom emojis that other users do not have access to for the live stream-->\r\n            <!--                    chat-->\r\n            <!--                </div>-->\r\n            <!--            </div>-->\r\n        </div>\r\n        <div class=\"subscriptionDivs\">\r\n            <div class=\"subscriptionLeftPart\">\r\n                <div class=\"subscriptionLeftPart1\" *ngIf=\"plan\">\r\n                    {{plan[0]?.custom_fields?.badgeColor | capitalizeAddSpaces}}\r\n                </div>\r\n                <div class=\"select\">\r\n                    <select (change)=\"onChange($event.target)\" class=\"custom_select\">\r\n                        <option value=\"\" class=\"custom_select_option\">Select for sale</option>\r\n                        <option value=\"3\" class=\"custom_select_option\">3% off for 3 months subscription</option>\r\n                        <option value=\"7\" class=\"custom_select_option\">7% off for 6 months. subscription</option>\r\n                        <option value=\"11\" class=\"custom_select_option\"> 11% off for a year. subscriptions</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"subscriptionLeftPart2\">\r\n                    <div class=\"sale_cost\" *ngIf=\"totalCost\">\r\n                        <sub class=\"sale\">For {{discountMonths}} {{discountMonths === 1 ? 'Year ' : 'Months ' }}</sub>\r\n                        <p class=\"sale_cost_text\">\r\n                            ${{totalCost}}\r\n                        </p>\r\n                    </div>\r\n                    <div class=\" subscriptionLeftDiv2\">$ {{constantCost}} {{totalCost ? ' ' : ' / Month'}}</div>\r\n                </div>\r\n            </div>\r\n            <button class=\"subscribeBtn\" (click)=\"openModalPayment()\">Subscribe</button>\r\n        </div>\r\n    </div>\r\n    <div class=\"belowGreyDiv\"></div>\r\n</div>\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { SubscriptionChanelComponent } from '@app/chanel-subscription/subscription-chanel/subscription-chanel.component';\r\nimport { PlanChanelComponent } from '@app/chanel-subscription/subscription-chanel/plan-chanel/plan-chanel.component';\r\n\r\n\r\nconst routes: Routes = [\r\n    {\r\n        path: '',\r\n        component: SubscriptionChanelComponent,\r\n        data: {\r\n            title: 'Channel Subscription'\r\n        }\r\n    },\r\n    {\r\n        path: 'plan-chanel',\r\n        component: PlanChanelComponent,\r\n        data: {\r\n            title: 'Plan Channel'\r\n        }\r\n    },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class ChanelSubscriptionRoutingModule { }\r\n","import {Component, OnInit} from '@angular/core';\r\nimport {ActivatedRoute} from '@angular/router';\r\nimport {CHANEL_SUBSCRIPTIONS_LIST} from '@core/constants/global';\r\nimport {Location} from '@angular/common';\r\nimport {Subscription} from 'rxjs';\r\nimport {SubjectService} from '@core/services/subject.service';\r\nimport {MatDialog} from '@angular/material/dialog';\r\nimport {PaymentPlanComponent} from '@core/components/modals/payment-plan/payment-plan.component';\r\nimport {PaymentCompletedComponent} from '@core/components/modals/payment-completed/payment-completed.component';\r\nimport {PaymentsService} from '@core/services/wallet/payments.service';\r\nimport {CurrentUserData} from '@core/interfaces';\r\nimport {UserInfoService} from '@core/services/user-info.service';\r\nimport {SubscriptionPlanService} from '@core/services/subscription-plan.service';\r\nimport {PlanChanelData, PlanChanelResponseInterface} from '@core/interfaces/plan-chanel.interface';\r\n\r\n@Component({\r\n    selector: 'app-plan-chanel',\r\n    templateUrl: './plan-chanel.component.html',\r\n    styleUrls: ['./plan-chanel.component.scss']\r\n})\r\nexport class PlanChanelComponent implements OnInit {\r\n\r\n    public params: any;\r\n    private planList = CHANEL_SUBSCRIPTIONS_LIST;\r\n    public plan: PlanChanelData [];\r\n    public planIcon: string;\r\n    public userCards;\r\n    public cost: any;\r\n    public constantCost: any;\r\n    public totalCost: any | undefined;\r\n    public planName: string;\r\n    public discount: number | undefined;\r\n    public discountMonths: number | undefined;\r\n    public plan_id: number | undefined;\r\n    private saleCostTotal: string;\r\n    subscriptions: Subscription[] = [];\r\n    authUser: CurrentUserData;\r\n\r\n    constructor(\r\n        private route: ActivatedRoute,\r\n        private _location: Location,\r\n        private subject: SubjectService,\r\n        private dialog: MatDialog,\r\n        private paymentsService: PaymentsService,\r\n        private _subscriptionPlanService: SubscriptionPlanService,\r\n        private _userInfoService: UserInfoService\r\n    ) {\r\n        this._getAuthInfo();\r\n        this.params = this.route.snapshot?.queryParams?.plan;\r\n        this.cost = this.route.snapshot?.queryParams?.cost;\r\n        this.constantCost = this.route.snapshot?.queryParams?.cost;\r\n        this.plan_id = this.route.snapshot?.queryParams?.plan_id;\r\n        console.log(this.plan_id,\"HRACH\");\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this._getPlan();\r\n        this.subscriptions.push(this.subject.currentUserCards.subscribe(dt => {\r\n            this.userCards = dt;\r\n        }));\r\n    }\r\n\r\n    private _getAuthInfo() {\r\n        this._userInfoService._userInfo.subscribe((data) => {\r\n            this.authUser = data;\r\n        });\r\n    }\r\n\r\n    private _getPlan() {\r\n        this._subscriptionPlanService.getSubscriptionPlanViewByPermission(this.params)\r\n            .subscribe((data: PlanChanelResponseInterface) => {\r\n                this.plan = data.data.reverse();\r\n                this.planList.forEach((elem) => {\r\n                    this.plan.forEach((element: any) => {\r\n                        if (elem.title.toLowerCase().includes(element.custom_fields.badgeColor)) {\r\n                            this.planIcon = elem.img;\r\n                            this.planName = element.custom_fields.badgeColor;\r\n                        }\r\n                    });\r\n\r\n                });\r\n            });\r\n    }\r\n\r\n    public onChange(event) {\r\n        if (+event.value) {\r\n            let total = this.cost * event.value;\r\n            this.totalCost = total;\r\n            this.saleCostTotal = (total - (total * (+event.value / 100))).toFixed(2);\r\n            this.constantCost = this.saleCostTotal;\r\n            this.discount = +event.value / 100;\r\n            if (+event.value > 3 && +event.value <= 7) {\r\n                this.discountMonths = 6;\r\n            } else if (+event.value > 7 && +event.value <= 11) {\r\n                this.discountMonths = 1;\r\n            } else {\r\n                this.discountMonths = +event.value;\r\n            }\r\n        } else {\r\n            let total = this.cost;\r\n            this.saleCostTotal = total;\r\n            this.constantCost = this.saleCostTotal;\r\n            this.discount = undefined;\r\n            this.totalCost = undefined;\r\n            this.discountMonths = undefined;\r\n        }\r\n\r\n    }\r\n\r\n    openModalPayment() {\r\n        this.dialog.open(PaymentPlanComponent, {\r\n            width: '1085px',\r\n            data: {\r\n                plan: this.plan,\r\n                cards: this.userCards,\r\n                cost: this.constantCost,\r\n                discount: this.discount\r\n            }\r\n        }).afterClosed().subscribe(dt => {\r\n            if (dt?.payment.paymentIntent.status === 'succeeded') {\r\n                this.dialog.open(PaymentCompletedComponent, {\r\n                    width: '591px',\r\n                    height: '292px'\r\n                }).afterClosed().subscribe();\r\n            }\r\n            this.paymentsService.getAllPaymentsHistory({\r\n                user_id: this.authUser.id,\r\n                customer: dt.customer\r\n            }).subscribe(ph => {\r\n                this.subject.setAllPaymentsData(ph);\r\n                this.subject.changePaymentsData(ph);\r\n                const buySubscriptionInfoForBack = {\r\n                    customer: dt.customer,\r\n                    discount: dt.discount,\r\n                    planId: +this.plan_id\r\n                };\r\n                this._subscriptionPlanService.buySubscriptionPlan(buySubscriptionInfoForBack)\r\n                    .subscribe((data: any) => {\r\n                    console.log(data);\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n\r\n    backPage() {\r\n        this._location.back();\r\n    }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { ChanelSubscriptionRoutingModule } from './chanel-subscription-routing.module';\r\nimport { SubscriptionChanelComponent } from './subscription-chanel/subscription-chanel.component';\r\nimport { PlanChanelComponent } from './subscription-chanel/plan-chanel/plan-chanel.component';\r\nimport {SharedModule} from '@shared/shared.module';\r\n\r\n\r\n@NgModule({\r\n  declarations: [SubscriptionChanelComponent, PlanChanelComponent],\r\n    imports: [\r\n        CommonModule,\r\n        ChanelSubscriptionRoutingModule,\r\n        SharedModule\r\n    ]\r\n})\r\nexport class ChanelSubscriptionModule { }\r\n"]}